# https://www.oomake.com/question/2034387
MACRO(SUBDIRLIST result curdir)
  FILE(GLOB children RELATIVE ${curdir} "${curdir}/*")
  SET(dirlist "")
  FOREACH(child ${children})
    IF(IS_DIRECTORY "${curdir}/${child}")
      LIST(APPEND dirlist "${child}")
    ENDIF()
  ENDFOREACH()
  SET(${result} ${dirlist})
ENDMACRO()

MACRO(ADD_SUB_DIRS curdir)
  SUBDIRLIST(subdirs "${PROJECT_SOURCE_DIR}/${curdir}")
  list(REMOVE_ITEM subdirs ".git")
  foreach(subdir ${subdirs})
    add_subdirectory("${PROJECT_SOURCE_DIR}/${curdir}/${subdir}")
  endforeach()
ENDMACRO()
